<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/cmd/main.go">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/cmd/main.go" />
              <option name="originalContent" value="package main&#10;&#10;import (&#10;&#9;&quot;minichat/internal/config&quot;&#10;&#9;&quot;minichat/internal/db&quot;&#10;&#9;&quot;minichat/internal/di&quot;&#10;&#9;userHandler &quot;minichat/internal/handler/user&quot;&#10;&#9;&quot;minichat/internal/repo/user&quot;&#10;&#9;&quot;minichat/internal/router&quot;&#10;&#9;userService &quot;minichat/internal/service/user&quot;&#10;&#9;&quot;minichat/util/logger&quot;&#10;&#10;&#9;&quot;github.com/gin-gonic/gin&quot;&#10;&#9;&quot;go.uber.org/zap&quot;&#10;)&#10;&#10;func main() {&#10;&#9;cfg := config.GetConfig()&#10;&#9;logger.InitLogger(&amp;logger.Config{&#10;&#9;&#9;Path:       cfg.Logger.Path,&#10;&#9;&#9;Level:      cfg.Logger.Level,&#10;&#9;&#9;MaxSize:    cfg.Logger.MaxSize,&#10;&#9;&#9;MaxBackups: cfg.Logger.MaxBackups,&#10;&#9;&#9;MaxAge:     cfg.Logger.MaxAge,&#10;&#9;&#9;Compress:   cfg.Logger.Compress,&#10;&#9;&#9;ToStdout:   cfg.Logger.ToStdout,&#10;&#9;})&#10;&#9;defer logger.Sync()&#10;&#10;&#9;gin.SetMode(cfg.Server.GinMode)&#10;&#10;&#9;// InitDB reads cfg.DB.driver/cfg.DB.dsn and runs AutoMigrate.&#10;&#9;database, err := db.InitDB()&#10;&#9;if err != nil {&#10;&#9;&#9;zap.L().Fatal(&quot;open db failed&quot;, zap.Error(err))&#10;&#9;}&#10;&#10;&#9;repo := user.NewUserRepo(database)&#10;&#9;svc := userService.NewUserService(repo)&#10;&#9;h := userHandler.NewUserHandler(svc)&#10;&#10;&#9;providers := &amp;di.HandlerProvider{UserHandler: h}&#10;&#10;&#9;r := gin.New()&#10;&#9;router.SetupRouter(r, providers)&#10;&#10;&#9;zap.L().Info(&quot;http server starting&quot;, zap.String(&quot;addr&quot;, cfg.Server.Addr), zap.String(&quot;mode&quot;, cfg.Server.GinMode))&#10;&#9;if err := r.Run(cfg.Server.Addr); err != nil {&#10;&#9;&#9;zap.L().Fatal(&quot;http server stopped&quot;, zap.Error(err))&#10;&#9;}&#10;}&#10;" />
              <option name="updatedContent" value="package main&#10;&#10;import (&#10;&#9;&quot;minichat/internal/config&quot;&#10;&#9;&quot;minichat/internal/db&quot;&#10;&#9;&quot;minichat/internal/di&quot;&#10;&#9;userHandler &quot;minichat/internal/handler/user&quot;&#10;&#9;&quot;minichat/internal/repo/user&quot;&#10;&#9;&quot;minichat/internal/router&quot;&#10;&#9;userService &quot;minichat/internal/service/user&quot;&#10;&#9;&quot;minichat/util/logger&quot;&#10;&#10;&#9;&quot;github.com/gin-gonic/gin&quot;&#10;&#9;&quot;go.uber.org/zap&quot;&#10;)&#10;&#10;func main() {&#10;&#9;cfg := config.GetConfig()&#10;&#9;logger.InitLogger(&amp;logger.Config{&#10;&#9;&#9;Path:       cfg.Logger.Path,&#10;&#9;&#9;Level:      cfg.Logger.Level,&#10;&#9;&#9;MaxSize:    cfg.Logger.MaxSize,&#10;&#9;&#9;MaxBackups: cfg.Logger.MaxBackups,&#10;&#9;&#9;MaxAge:     cfg.Logger.MaxAge,&#10;&#9;&#9;Compress:   cfg.Logger.Compress,&#10;&#9;&#9;ToStdout:   cfg.Logger.ToStdout,&#10;&#9;})&#10;&#9;defer logger.Sync()&#10;&#10;&#9;gin.SetMode(cfg.Server.GinMode)&#10;&#10;&#9;// InitDB reads cfg.DB.driver/cfg.DB.dsn and runs AutoMigrate.&#10;&#9;database, err := db.InitDB()&#10;&#9;if err != nil {&#10;&#9;&#9;zap.L().Fatal(&quot;open db failed&quot;, zap.Error(err))&#10;&#9;}&#10;&#10;&#9;repo := user.NewUserRepo(database)&#10;&#9;svc := userService.NewUserService(repo)&#10;&#9;h := userHandler.NewUserHandler(svc)&#10;&#10;&#9;providers := &amp;di.HandlerProvider{UserHandler: h}&#10;&#10;&#9;r := gin.New()&#10;&#9;router.SetupRouter(r, providers)&#10;&#10;&#9;zap.L().Info(&quot;http server starting&quot;, zap.String(&quot;addr&quot;, cfg.Server.Addr), zap.String(&quot;mode&quot;, cfg.Server.GinMode))&#10;&#9;if err := r.Run(cfg.Server.Addr); err != nil {&#10;&#9;&#9;zap.L().Fatal(&quot;http server stopped&quot;, zap.Error(err))&#10;&#9;}&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/internal/config/config.yaml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/internal/config/config.yaml" />
              <option name="originalContent" value="server:&#10;  addr: &quot;:8080&quot;&#10;  # debug | release | test&#10;  gin_mode: &quot;debug&quot;&#10;&#10;logger:&#10;  path: &quot;./logs/minichat.log&quot;&#10;  level: &quot;debug&quot;&#10;  max_size: 100&#10;  max_backups: 7&#10;  max_age: 30&#10;  compress: false&#10;  to_stdout: true&#10;&#10;db:&#10;  # 目前项目内置 OpenForDev() 走 sqlite，这里先把 dsn 留给后续扩展&#10;  driver: &quot;sqlite&quot;&#10;  dsn: &quot;minichat.db&quot;&#10;&#10;jwt:&#10;  # 生产环境请用环境变量覆盖 MINICHAT_JWT_SECRET&#10;  secret: &quot;minichat-dev-secret-change-me&quot;&#10;  access_ttl_minutes: 120&#10;  refresh_ttl_hours: 168&#10;" />
              <option name="updatedContent" value="server:&#10;  addr: &quot;:8080&quot;&#10;  # debug | release | test&#10;  gin_mode: &quot;debug&quot;&#10;&#10;logger:&#10;  path: &quot;./logs/minichat.log&quot;&#10;  level: &quot;debug&quot;&#10;  max_size: 100&#10;  max_backups: 7&#10;  max_age: 30&#10;  compress: false&#10;  to_stdout: true&#10;&#10;db:&#10;  # 目前项目内置 OpenForDev() 走 sqlite，这里先把 dsn 留给后续扩展&#10;  driver: &quot;sqlite&quot;&#10;  dsn: &quot;minichat.db&quot;&#10;&#10;jwt:&#10;  # 生产环境请用环境变量覆盖 MINICHAT_JWT_SECRET&#10;  secret: &quot;minichat-dev-secret-change-me&quot;&#10;  access_ttl_minutes: 120&#10;  refresh_ttl_hours: 168&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/internal/model/ddl_mysql.sql">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/internal/model/ddl_mysql.sql" />
              <option name="originalContent" value="-- MySQL DDL for minichat&#10;-- Charset/engine can be adjusted for your environment.&#10;&#10;CREATE TABLE IF NOT EXISTS `users` (&#10;  `id` BIGINT NOT NULL,&#10;  `username` VARCHAR(64) NOT NULL,&#10;  `password` VARCHAR(255) NOT NULL,&#10;  `nickname` VARCHAR(64) DEFAULT NULL,&#10;  `avatar` VARCHAR(255) DEFAULT NULL,&#10;  `status` TINYINT NOT NULL DEFAULT 0 COMMENT '用户状态(0离线/1在线/2注销)',&#10;  `created_at` DATETIME NOT NULL COMMENT '注册时间',&#10;  PRIMARY KEY (`id`),&#10;  UNIQUE KEY `uk_users_username` (`username`)&#10;) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;&#10;&#10;CREATE TABLE IF NOT EXISTS `friends` (&#10;  `id` BIGINT NOT NULL,&#10;  `user_id` BIGINT NOT NULL COMMENT '本人ID',&#10;  `friend_id` BIGINT NOT NULL COMMENT '好友ID',&#10;  `remark` VARCHAR(64) DEFAULT NULL COMMENT '备注',&#10;  `status` TINYINT NOT NULL DEFAULT 0 COMMENT '0申请中/1已通过/2黑名单',&#10;  `created_at` DATETIME NOT NULL,&#10;  `updated_at` DATETIME NOT NULL,&#10;  PRIMARY KEY (`id`),&#10;  UNIQUE KEY `uk_user_friend` (`user_id`,`friend_id`),&#10;  KEY `idx_friends_user_id` (`user_id`),&#10;  KEY `idx_friends_friend_id` (`friend_id`)&#10;) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;&#10;&#10;CREATE TABLE IF NOT EXISTS `messages` (&#10;  `id` BIGINT NOT NULL COMMENT '消息ID(建议使用分布式ID)',&#10;  `sender_id` BIGINT NOT NULL,&#10;  `receiver_id` BIGINT NOT NULL,&#10;  `msg_type` TINYINT NOT NULL COMMENT '1文字/2图片/3语音/4视频',&#10;  `content` TEXT,&#10;  `is_read` BOOLEAN NOT NULL DEFAULT FALSE,&#10;  `created_at` DATETIME NOT NULL,&#10;  PRIMARY KEY (`id`),&#10;  KEY `idx_sender_receiver` (`sender_id`,`receiver_id`),&#10;  KEY `idx_messages_created_at` (`created_at`)&#10;) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;&#10;&#10;CREATE TABLE IF NOT EXISTS `groups` (&#10;  `id` BIGINT NOT NULL,&#10;  `name` VARCHAR(64) NOT NULL,&#10;  `owner_id` BIGINT NOT NULL,&#10;  `announcement` TEXT,&#10;  `avatar` VARCHAR(255) DEFAULT NULL,&#10;  `created_at` DATETIME NOT NULL,&#10;  `updated_at` DATETIME NOT NULL,&#10;  PRIMARY KEY (`id`),&#10;  KEY `idx_groups_owner_id` (`owner_id`)&#10;) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;&#10;&#10;CREATE TABLE IF NOT EXISTS `group_members` (&#10;  `group_id` BIGINT NOT NULL,&#10;  `user_id` BIGINT NOT NULL,&#10;  `nickname` VARCHAR(64) DEFAULT NULL,&#10;  `role` TINYINT NOT NULL DEFAULT 0 COMMENT '0普通/1管理员/2群主',&#10;  `created_at` DATETIME NOT NULL,&#10;  `updated_at` DATETIME NOT NULL,&#10;  PRIMARY KEY (`group_id`,`user_id`),&#10;  KEY `idx_gm_group_id` (`group_id`),&#10;  KEY `idx_gm_user_id` (`user_id`)&#10;) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;&#10;&#10;CREATE TABLE IF NOT EXISTS `sessions` (&#10;  `id` BIGINT NOT NULL,&#10;  `user_id` BIGINT NOT NULL,&#10;  `target_id` BIGINT NOT NULL,&#10;  `type` TINYINT NOT NULL COMMENT '1私聊/2群聊',&#10;  `last_msg` VARCHAR(255) DEFAULT NULL,&#10;  `unread_count` INT NOT NULL DEFAULT 0,&#10;  `updated_at` DATETIME NOT NULL,&#10;  PRIMARY KEY (`id`),&#10;  UNIQUE KEY `uk_user_target_type` (`user_id`,`target_id`,`type`),&#10;  KEY `idx_sessions_user_id` (`user_id`),&#10;  KEY `idx_sessions_updated_at` (`updated_at`)&#10;) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;&#10;" />
              <option name="updatedContent" value="-- MySQL DDL for minichat&#10;-- Charset/engine can be adjusted for your environment.&#10;&#10;CREATE TABLE IF NOT EXISTS `users` (&#10;  `id` BIGINT NOT NULL,&#10;  `username` VARCHAR(64) NOT NULL,&#10;  `password` VARCHAR(255) NOT NULL,&#10;  `nickname` VARCHAR(64) DEFAULT NULL,&#10;  `avatar` VARCHAR(255) DEFAULT NULL,&#10;  `status` TINYINT NOT NULL DEFAULT 0 COMMENT '用户状态(0离线/1在线/2注销)',&#10;  `created_at` DATETIME NOT NULL COMMENT '注册时间',&#10;  PRIMARY KEY (`id`),&#10;  UNIQUE KEY `uk_users_username` (`username`)&#10;) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;&#10;&#10;CREATE TABLE IF NOT EXISTS `friends` (&#10;  `id` BIGINT NOT NULL,&#10;  `user_id` BIGINT NOT NULL COMMENT '本人ID',&#10;  `friend_id` BIGINT NOT NULL COMMENT '好友ID',&#10;  `remark` VARCHAR(64) DEFAULT NULL COMMENT '备注',&#10;  `status` TINYINT NOT NULL DEFAULT 0 COMMENT '0申请中/1已通过/2黑名单',&#10;  `created_at` DATETIME NOT NULL,&#10;  `updated_at` DATETIME NOT NULL,&#10;  PRIMARY KEY (`id`),&#10;  UNIQUE KEY `uk_user_friend` (`user_id`,`friend_id`),&#10;  KEY `idx_friends_user_id` (`user_id`),&#10;  KEY `idx_friends_friend_id` (`friend_id`)&#10;) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;&#10;&#10;CREATE TABLE IF NOT EXISTS `messages` (&#10;  `id` BIGINT NOT NULL COMMENT '消息ID(建议使用分布式ID)',&#10;  `sender_id` BIGINT NOT NULL,&#10;  `receiver_id` BIGINT NOT NULL,&#10;  `msg_type` TINYINT NOT NULL COMMENT '1文字/2图片/3语音/4视频',&#10;  `content` TEXT,&#10;  `is_read` BOOLEAN NOT NULL DEFAULT FALSE,&#10;  `created_at` DATETIME NOT NULL,&#10;  PRIMARY KEY (`id`),&#10;  KEY `idx_sender_receiver` (`sender_id`,`receiver_id`),&#10;  KEY `idx_messages_created_at` (`created_at`)&#10;) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;&#10;&#10;CREATE TABLE IF NOT EXISTS `groups` (&#10;  `id` BIGINT NOT NULL,&#10;  `name` VARCHAR(64) NOT NULL,&#10;  `owner_id` BIGINT NOT NULL,&#10;  `announcement` TEXT,&#10;  `avatar` VARCHAR(255) DEFAULT NULL,&#10;  `created_at` DATETIME NOT NULL,&#10;  `updated_at` DATETIME NOT NULL,&#10;  PRIMARY KEY (`id`),&#10;  KEY `idx_groups_owner_id` (`owner_id`)&#10;) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;&#10;&#10;CREATE TABLE IF NOT EXISTS `group_members` (&#10;  `group_id` BIGINT NOT NULL,&#10;  `user_id` BIGINT NOT NULL,&#10;  `nickname` VARCHAR(64) DEFAULT NULL,&#10;  `role` TINYINT NOT NULL DEFAULT 0 COMMENT '0普通/1管理员/2群主',&#10;  `created_at` DATETIME NOT NULL,&#10;  `updated_at` DATETIME NOT NULL,&#10;  PRIMARY KEY (`group_id`,`user_id`),&#10;  KEY `idx_gm_group_id` (`group_id`),&#10;  KEY `idx_gm_user_id` (`user_id`)&#10;) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;&#10;&#10;CREATE TABLE IF NOT EXISTS `sessions` (&#10;  `id` BIGINT NOT NULL,&#10;  `user_id` BIGINT NOT NULL,&#10;  `target_id` BIGINT NOT NULL,&#10;  `type` TINYINT NOT NULL COMMENT '1私聊/2群聊',&#10;  `last_msg` VARCHAR(255) DEFAULT NULL,&#10;  `unread_count` INT NOT NULL DEFAULT 0,&#10;  `updated_at` DATETIME NOT NULL,&#10;  PRIMARY KEY (`id`),&#10;  UNIQUE KEY `uk_user_target_type` (`user_id`,`target_id`,`type`),&#10;  KEY `idx_sessions_user_id` (`user_id`),&#10;  KEY `idx_sessions_updated_at` (`updated_at`)&#10;) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/internal/model/friend_apply.go">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/internal/model/friend_apply.go" />
              <option name="originalContent" value="package model&#10;&#10;import &quot;time&quot;&#10;&#10;// Friend 表示好友关系（推荐插入两条：A-&gt;B 与 B-&gt;A）&#10;// Status: 0申请中, 1已通过, 2黑名单&#10;type Friend struct {&#10;&#9;ID       int64  `gorm:&quot;primaryKey;type:BIGINT&quot; json:&quot;id&quot;`&#10;&#9;UserID   int64  `gorm:&quot;type:BIGINT;not null;index;uniqueIndex:uk_user_friend&quot; json:&quot;user_id&quot;`&#10;&#9;FriendID int64  `gorm:&quot;type:BIGINT;not null;index;uniqueIndex:uk_user_friend&quot; json:&quot;friend_id&quot;`&#10;&#9;Remark   string `gorm:&quot;type:VARCHAR(64)&quot; json:&quot;remark&quot;`&#10;&#9;Status   int8   `gorm:&quot;type:TINYINT;not null;default:0;comment:0申请中/1已通过/2黑名单&quot; json:&quot;status&quot;`&#10;&#10;&#9;CreatedAt time.Time `gorm:&quot;type:DATETIME;not null;autoCreateTime&quot; json:&quot;created_at&quot;`&#10;&#9;UpdatedAt time.Time `gorm:&quot;type:DATETIME;not null;autoUpdateTime&quot; json:&quot;updated_at&quot;`&#10;}&#10;&#10;func (Friend) TableName() string { return &quot;friends&quot; }" />
              <option name="updatedContent" value="package model&#10;&#10;import &quot;time&quot;&#10;&#10;// Friend 表示好友关系（推荐插入两条：A-&gt;B 与 B-&gt;A）&#10;// Status: 0申请中, 1已通过, 2黑名单&#10;type Friend struct {&#10;&#9;ID       int64  `gorm:&quot;primaryKey;type:BIGINT&quot; json:&quot;id&quot;`&#10;&#9;UserID   int64  `gorm:&quot;type:BIGINT;not null;index;uniqueIndex:uk_user_friend&quot; json:&quot;user_id&quot;`&#10;&#9;FriendID int64  `gorm:&quot;type:BIGINT;not null;index;uniqueIndex:uk_user_friend&quot; json:&quot;friend_id&quot;`&#10;&#9;Remark   string `gorm:&quot;type:VARCHAR(64)&quot; json:&quot;remark&quot;`&#10;&#9;Status   int8   `gorm:&quot;type:TINYINT;not null;default:0;comment:0申请中/1已通过/2黑名单&quot; json:&quot;status&quot;`&#10;&#10;&#9;CreatedAt time.Time `gorm:&quot;type:DATETIME;not null;autoCreateTime&quot; json:&quot;created_at&quot;`&#10;&#9;UpdatedAt time.Time `gorm:&quot;type:DATETIME;not null;autoUpdateTime&quot; json:&quot;updated_at&quot;`&#10;}&#10;&#10;func (Friend) TableName() string { return &quot;friends&quot; }" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/internal/model/group_info.go">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/internal/model/group_info.go" />
              <option name="originalContent" value="package model&#10;&#10;import &quot;time&quot;&#10;&#10;type Group struct {&#10;&#9;ID           int64  `gorm:&quot;primaryKey;type:BIGINT&quot; json:&quot;id&quot;`&#10;&#9;Name         string `gorm:&quot;type:VARCHAR(64);not null&quot; json:&quot;name&quot;`&#10;&#9;OwnerID      int64  `gorm:&quot;type:BIGINT;not null;index&quot; json:&quot;owner_id&quot;`&#10;&#9;Announcement string `gorm:&quot;type:TEXT&quot; json:&quot;announcement&quot;`&#10;&#9;Avatar       string `gorm:&quot;type:VARCHAR(255)&quot; json:&quot;avatar&quot;`&#10;&#10;&#9;CreatedAt time.Time `gorm:&quot;type:DATETIME;not null;autoCreateTime&quot; json:&quot;created_at&quot;`&#10;&#9;UpdatedAt time.Time `gorm:&quot;type:DATETIME;not null;autoUpdateTime&quot; json:&quot;updated_at&quot;`&#10;}&#10;&#10;func (Group) TableName() string { return &quot;groups&quot; }&#10;&#10;// GroupMember 群成员&#10;// Role: 0普通成员, 1管理员, 2群主&#10;type GroupMember struct {&#10;&#9;GroupID  int64  `gorm:&quot;type:BIGINT;not null;primaryKey&quot; json:&quot;group_id&quot;`&#10;&#9;UserID   int64  `gorm:&quot;type:BIGINT;not null;primaryKey&quot; json:&quot;user_id&quot;`&#10;&#9;Nickname string `gorm:&quot;type:VARCHAR(64)&quot; json:&quot;nickname&quot;`&#10;&#9;Role     int8   `gorm:&quot;type:TINYINT;not null;default:0&quot; json:&quot;role&quot;`&#10;&#10;&#9;CreatedAt time.Time `gorm:&quot;type:DATETIME;not null;autoCreateTime&quot; json:&quot;created_at&quot;`&#10;&#9;UpdatedAt time.Time `gorm:&quot;type:DATETIME;not null;autoUpdateTime&quot; json:&quot;updated_at&quot;`&#10;}&#10;&#10;func (GroupMember) TableName() string { return &quot;group_members&quot; }" />
              <option name="updatedContent" value="package model&#10;&#10;import &quot;time&quot;&#10;&#10;type Group struct {&#10;&#9;ID           int64  `gorm:&quot;primaryKey;type:BIGINT&quot; json:&quot;id&quot;`&#10;&#9;Name         string `gorm:&quot;type:VARCHAR(64);not null&quot; json:&quot;name&quot;`&#10;&#9;OwnerID      int64  `gorm:&quot;type:BIGINT;not null;index&quot; json:&quot;owner_id&quot;`&#10;&#9;Announcement string `gorm:&quot;type:TEXT&quot; json:&quot;announcement&quot;`&#10;&#9;Avatar       string `gorm:&quot;type:VARCHAR(255)&quot; json:&quot;avatar&quot;`&#10;&#10;&#9;CreatedAt time.Time `gorm:&quot;type:DATETIME;not null;autoCreateTime&quot; json:&quot;created_at&quot;`&#10;&#9;UpdatedAt time.Time `gorm:&quot;type:DATETIME;not null;autoUpdateTime&quot; json:&quot;updated_at&quot;`&#10;}&#10;&#10;func (Group) TableName() string { return &quot;groups&quot; }&#10;&#10;// GroupMember 群成员&#10;// Role: 0普通成员, 1管理员, 2群主&#10;type GroupMember struct {&#10;&#9;GroupID  int64  `gorm:&quot;type:BIGINT;not null;primaryKey&quot; json:&quot;group_id&quot;`&#10;&#9;UserID   int64  `gorm:&quot;type:BIGINT;not null;primaryKey&quot; json:&quot;user_id&quot;`&#10;&#9;Nickname string `gorm:&quot;type:VARCHAR(64)&quot; json:&quot;nickname&quot;`&#10;&#9;Role     int8   `gorm:&quot;type:TINYINT;not null;default:0&quot; json:&quot;role&quot;`&#10;&#10;&#9;CreatedAt time.Time `gorm:&quot;type:DATETIME;not null;autoCreateTime&quot; json:&quot;created_at&quot;`&#10;&#9;UpdatedAt time.Time `gorm:&quot;type:DATETIME;not null;autoUpdateTime&quot; json:&quot;updated_at&quot;`&#10;}&#10;&#10;func (GroupMember) TableName() string { return &quot;group_members&quot; }" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/internal/model/message.go">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/internal/model/message.go" />
              <option name="originalContent" value="package model&#10;&#10;import &quot;time&quot;&#10;&#10;// Message 私聊消息&#10;// MsgType: 1文字, 2图片, 3语音, 4视频&#10;type Message struct {&#10;&#9;ID         int64     `gorm:&quot;primaryKey;type:BIGINT&quot; json:&quot;id&quot;`&#10;&#9;SenderID   int64     `gorm:&quot;type:BIGINT;not null;index:idx_sender_receiver,priority:1&quot; json:&quot;sender_id&quot;`&#10;&#9;ReceiverID int64     `gorm:&quot;type:BIGINT;not null;index:idx_sender_receiver,priority:2&quot; json:&quot;receiver_id&quot;`&#10;&#9;MsgType    int8      `gorm:&quot;type:TINYINT;not null&quot; json:&quot;msg_type&quot;`&#10;&#9;Content    string    `gorm:&quot;type:TEXT&quot; json:&quot;content&quot;`&#10;&#9;IsRead     bool      `gorm:&quot;type:BOOLEAN;not null;default:false&quot; json:&quot;is_read&quot;`&#10;&#9;CreatedAt  time.Time `gorm:&quot;type:DATETIME;not null;autoCreateTime;index&quot; json:&quot;created_at&quot;`&#10;}&#10;&#10;func (Message) TableName() string { return &quot;messages&quot; }" />
              <option name="updatedContent" value="package model&#10;&#10;import &quot;time&quot;&#10;&#10;// Message 私聊消息&#10;// MsgType: 1文字, 2图片, 3语音, 4视频&#10;type Message struct {&#10;&#9;ID         int64     `gorm:&quot;primaryKey;type:BIGINT&quot; json:&quot;id&quot;`&#10;&#9;SenderID   int64     `gorm:&quot;type:BIGINT;not null;index:idx_sender_receiver,priority:1&quot; json:&quot;sender_id&quot;`&#10;&#9;ReceiverID int64     `gorm:&quot;type:BIGINT;not null;index:idx_sender_receiver,priority:2&quot; json:&quot;receiver_id&quot;`&#10;&#9;MsgType    int8      `gorm:&quot;type:TINYINT;not null&quot; json:&quot;msg_type&quot;`&#10;&#9;Content    string    `gorm:&quot;type:TEXT&quot; json:&quot;content&quot;`&#10;&#9;IsRead     bool      `gorm:&quot;type:BOOLEAN;not null;default:false&quot; json:&quot;is_read&quot;`&#10;&#9;CreatedAt  time.Time `gorm:&quot;type:DATETIME;not null;autoCreateTime;index&quot; json:&quot;created_at&quot;`&#10;}&#10;&#10;func (Message) TableName() string { return &quot;messages&quot; }" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/internal/model/session.go">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/internal/model/session.go" />
              <option name="originalContent" value="package model&#10;&#10;import &quot;time&quot;&#10;&#10;// Session 会话列表（Inbox）&#10;// Type: 1私聊, 2群聊&#10;type Session struct {&#10;&#9;ID          int64     `gorm:&quot;primaryKey;type:BIGINT&quot; json:&quot;id&quot;`&#10;&#9;UserID      int64     `gorm:&quot;type:BIGINT;not null;index;uniqueIndex:uk_user_target_type,priority:1&quot; json:&quot;user_id&quot;`&#10;&#9;TargetID    int64     `gorm:&quot;type:BIGINT;not null;index;uniqueIndex:uk_user_target_type,priority:2&quot; json:&quot;target_id&quot;`&#10;&#9;Type        int8      `gorm:&quot;type:TINYINT;not null;uniqueIndex:uk_user_target_type,priority:3&quot; json:&quot;type&quot;`&#10;&#9;LastMsg     string    `gorm:&quot;type:VARCHAR(255)&quot; json:&quot;last_msg&quot;`&#10;&#9;UnreadCount int32     `gorm:&quot;type:INT;not null;default:0&quot; json:&quot;unread_count&quot;`&#10;&#9;UpdatedAt   time.Time `gorm:&quot;type:DATETIME;not null;autoUpdateTime;index&quot; json:&quot;updated_at&quot;`&#10;}&#10;&#10;func (Session) TableName() string { return &quot;sessions&quot; }" />
              <option name="updatedContent" value="package model&#10;&#10;import &quot;time&quot;&#10;&#10;// Session 会话列表（Inbox）&#10;// Type: 1私聊, 2群聊&#10;type Session struct {&#10;&#9;ID          int64     `gorm:&quot;primaryKey;type:BIGINT&quot; json:&quot;id&quot;`&#10;&#9;UserID      int64     `gorm:&quot;type:BIGINT;not null;index;uniqueIndex:uk_user_target_type,priority:1&quot; json:&quot;user_id&quot;`&#10;&#9;TargetID    int64     `gorm:&quot;type:BIGINT;not null;index;uniqueIndex:uk_user_target_type,priority:2&quot; json:&quot;target_id&quot;`&#10;&#9;Type        int8      `gorm:&quot;type:TINYINT;not null;uniqueIndex:uk_user_target_type,priority:3&quot; json:&quot;type&quot;`&#10;&#9;LastMsg     string    `gorm:&quot;type:VARCHAR(255)&quot; json:&quot;last_msg&quot;`&#10;&#9;UnreadCount int32     `gorm:&quot;type:INT;not null;default:0&quot; json:&quot;unread_count&quot;`&#10;&#9;UpdatedAt   time.Time `gorm:&quot;type:DATETIME;not null;autoUpdateTime;index&quot; json:&quot;updated_at&quot;`&#10;}&#10;&#10;func (Session) TableName() string { return &quot;sessions&quot; }" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/internal/model/user_info.go">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/internal/model/user_info.go" />
              <option name="originalContent" value="package model&#10;&#10;import &quot;time&quot;&#10;&#10;type User struct {&#10;&#9;ID        int64  `gorm:&quot;primaryKey;type:BIGINT&quot; json:&quot;id&quot;`&#10;&#9;Username  string `gorm:&quot;type:VARCHAR(64);uniqueIndex;not null&quot; json:&quot;username&quot;`&#10;&#9;Telephone string `gorm:&quot;type:VARCHAR(20);uniqueIndex;not null&quot; json:&quot;telephone&quot;`&#10;&#9;Password  string `gorm:&quot;type:VARCHAR(255);not null&quot; json:&quot;-&quot;`&#10;&#9;Nickname  string `gorm:&quot;type:VARCHAR(64)&quot; json:&quot;nickname&quot;`&#10;&#9;Avatar    string `gorm:&quot;type:VARCHAR(255)&quot; json:&quot;avatar&quot;`&#10;&#9;Status    int8   `gorm:&quot;type:TINYINT;not null;default:0;comment:用户状态(0离线/1在线/2注销)&quot; json:&quot;status&quot;`&#10;&#10;&#9;CreatedAt time.Time `gorm:&quot;type:DATETIME;not null;autoCreateTime&quot; json:&quot;created_at&quot;`&#10;&#9;UpdatedAt time.Time `gorm:&quot;type:DATETIME;not null;autoUpdateTime&quot; json:&quot;updated_at&quot;`&#10;&#10;&#9;UsernameChangedAt *time.Time `gorm:&quot;column:username_changed_at;comment:username上次修改时间&quot; json:&quot;username_changed_at&quot;`&#10;}&#10;&#10;// TableName 定义表名。&#10;// 注意：MySQL 中 `user` 是系统表名/保留语义，可能导致迁移或权限问题；建议使用 `users`。&#10;func (User) TableName() string { return &quot;users&quot; }" />
              <option name="updatedContent" value="package model&#10;&#10;import &quot;time&quot;&#10;&#10;type User struct {&#10;&#9;ID        int64  `gorm:&quot;primaryKey;type:BIGINT&quot; json:&quot;id&quot;`&#10;&#9;Username  string `gorm:&quot;type:VARCHAR(64);uniqueIndex;not null&quot; json:&quot;username&quot;`&#10;&#9;Telephone string `gorm:&quot;type:VARCHAR(20);uniqueIndex;not null&quot; json:&quot;telephone&quot;`&#10;&#9;Password  string `gorm:&quot;type:VARCHAR(255);not null&quot; json:&quot;-&quot;`&#10;&#9;Nickname  string `gorm:&quot;type:VARCHAR(64)&quot; json:&quot;nickname&quot;`&#10;&#9;Avatar    string `gorm:&quot;type:VARCHAR(255)&quot; json:&quot;avatar&quot;`&#10;&#9;Status    int8   `gorm:&quot;type:TINYINT;not null;default:0;comment:用户状态(0离线/1在线/2注销)&quot; json:&quot;status&quot;`&#10;&#10;&#9;CreatedAt time.Time `gorm:&quot;type:DATETIME;not null;autoCreateTime&quot; json:&quot;created_at&quot;`&#10;&#9;UpdatedAt time.Time `gorm:&quot;type:DATETIME;not null;autoUpdateTime&quot; json:&quot;updated_at&quot;`&#10;&#10;&#9;UsernameChangedAt *time.Time `gorm:&quot;column:username_changed_at;comment:username上次修改时间&quot; json:&quot;username_changed_at&quot;`&#10;}&#10;&#10;// TableName 定义表名。&#10;// 注意：MySQL 中 `user` 是系统表名/保留语义，可能导致迁移或权限问题；建议使用 `users`。&#10;func (User) TableName() string { return &quot;users&quot; }" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/util/snowflake/gen_id.go">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/util/snowflake/gen_id.go" />
              <option name="originalContent" value="package snowflake&#10;&#10;import (&#10;&#9;&quot;os&quot;&#10;&#9;&quot;strconv&quot;&#10;&#9;&quot;sync&quot;&#10;&#10;&#9;&quot;github.com/bwmarrin/snowflake&quot;&#10;)&#10;&#10;var (&#10;&#9;node *snowflake.Node&#10;&#9;once sync.Once&#10;)&#10;&#10;// Init 初始化雪花算法节点。&#10;// 一般在 main 启动时调用；如果没调用，Gen* 会使用默认 machineID(1) 做兜底初始化。&#10;func Init(machineID int64) error {&#10;&#9;var err error&#10;&#9;once.Do(func() {&#10;&#9;&#9;node, err = snowflake.NewNode(machineID)&#10;&#9;})&#10;&#9;return err&#10;}&#10;&#10;func ensureInit() {&#10;&#9;if node != nil {&#10;&#9;&#9;return&#10;&#9;}&#10;&#9;// allow env override&#10;&#9;machineID := int64(1)&#10;&#9;if v := os.Getenv(&quot;MINICHAT_SNOWFLAKE_MACHINE_ID&quot;); v != &quot;&quot; {&#10;&#9;&#9;if n, err := strconv.ParseInt(v, 10, 64); err == nil {&#10;&#9;&#9;&#9;machineID = n&#10;&#9;&#9;}&#10;&#9;}&#10;&#9;_ = Init(machineID)&#10;}&#10;&#10;// GenStringID returns a unique snowflake ID in string form.&#10;func GenStringID() string {&#10;&#9;ensureInit()&#10;&#9;return node.Generate().String()&#10;}&#10;&#10;// GenInt64ID returns a unique snowflake ID as int64.&#10;func GenInt64ID() int64 {&#10;&#9;ensureInit()&#10;&#9;return node.Generate().Int64()&#10;}" />
              <option name="updatedContent" value="package snowflake&#10;&#10;import (&#10;&#9;&quot;os&quot;&#10;&#9;&quot;strconv&quot;&#10;&#9;&quot;sync&quot;&#10;&#10;&#9;&quot;github.com/bwmarrin/snowflake&quot;&#10;)&#10;&#10;var (&#10;&#9;node *snowflake.Node&#10;&#9;once sync.Once&#10;)&#10;&#10;// Init 初始化雪花算法节点。&#10;// 一般在 main 启动时调用；如果没调用，Gen* 会使用默认 machineID(1) 做兜底初始化。&#10;func Init(machineID int64) error {&#10;&#9;var err error&#10;&#9;once.Do(func() {&#10;&#9;&#9;node, err = snowflake.NewNode(machineID)&#10;&#9;})&#10;&#9;return err&#10;}&#10;&#10;func ensureInit() {&#10;&#9;if node != nil {&#10;&#9;&#9;return&#10;&#9;}&#10;&#9;// allow env override&#10;&#9;machineID := int64(1)&#10;&#9;if v := os.Getenv(&quot;MINICHAT_SNOWFLAKE_MACHINE_ID&quot;); v != &quot;&quot; {&#10;&#9;&#9;if n, err := strconv.ParseInt(v, 10, 64); err == nil {&#10;&#9;&#9;&#9;machineID = n&#10;&#9;&#9;}&#10;&#9;}&#10;&#9;_ = Init(machineID)&#10;}&#10;&#10;// GenStringID returns a unique snowflake ID in string form.&#10;func GenStringID() string {&#10;&#9;ensureInit()&#10;&#9;return node.Generate().String()&#10;}&#10;&#10;// GenInt64ID returns a unique snowflake ID as int64.&#10;func GenInt64ID() int64 {&#10;&#9;ensureInit()&#10;&#9;return node.Generate().Int64()&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>